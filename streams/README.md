Я решил использовать один [transform класс](./src/transform/textTransform.js), в который можно закинуть множество стратегий, которые с помощью метода change будут менять строку. Так как мне нужно хранить для каждого объекта transform свои объекты стратегий (например, для сохранения параметра номера строки), я использую билдеры стратегий. Иначе из-за асинхронности номера строк не будут учитываться сразу для всех файлов одновременно по мере поступления чанков.

Проблему с пропуском слов **(1)**, которые нужно отфильтровать, я решил следующим образом. Сперва в [configReader.js](./src/configReader.js) я узнаю, сколько байт занимает максимальная строка для фильтрации в конфиге. Если она меньше параметра `highWaterMark`, я приравниваю `highWaterMark` к количеству байт в максимальной строке фильтрации. Это не даст строке фильтрации занять больше чем два чанка. Далее я объединяю `prevChunk` с `chunk` и обрабатываю их с помощью стратегий. После того как я обработал строку, ее надо как-то разделить. Делаю я это с помощью метода `_splitStringByCharacters`. Он разделяет строку, выделяя с правой стороны `highWaterMark` символов. Левая часть **(2)** записывается в файл, а правая становится `prevChunk`.

Проблема с фильтрацией решена, но появилась новая. С помощью этого алгоритма **(1)** очень неудобно обрабатывать строки со стратегиями, которые рассчитаны на неповторяющиеся чанки. Например, если мне нужно найти каждый перенос строки `'\n'` в чанке и добавить к этому знаку номер строки, алгоритм может несколько раз обработать некоторую часть чанка, из-за чего получится что-то типа `"\n1|2|3|"` вместо `"\n1|"`. Поэтому я решил разделить стратегии на `combinedStrategiesBuilders = []` и `splitStrategiesBuilders = []`. Стратегии `combinedStrategiesBuilders` будут обрабатываться с помощью алгоритма **(1)**, а `splitStrategiesBuilders` будут работать над уже обработанной левой частью **(2)** чанка.

---

В итоге решение получилось:
* расширяемым — легко можно добавить собственный алгоритм,
* быстрым — несколько раз будут обрабатываться части чанка только тех стратегий, которые разработчик посчитает необходимыми (в моем случае фильтрация строк).

---

Файл запуска: [index.js](./index.js)
